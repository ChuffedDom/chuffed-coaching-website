<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Screenshot Organizer App</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #1a202c; /* Dark background similar to a Mac desktop */
      }
    </style>
  </head>
  <body class="flex items-center justify-center min-h-screen p-4">
    <!-- App Window Container -->
    <div
      class="bg-gray-800 text-gray-100 w-full max-w-7xl h-[80vh] rounded-2xl shadow-2xl flex overflow-hidden"
    >
      <!-- Sidebar - Categories & Tags -->
      <aside class="w-64 bg-gray-900 p-6 flex flex-col">
        <h1 class="text-2xl font-bold mb-6">Screenshot Organizer</h1>

        <!-- Search Bar -->
        <div class="mb-6">
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-3">
              <svg
                class="h-5 w-5 text-gray-400"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fill-rule="evenodd"
                  d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </span>
            <input
              type="search"
              id="searchInput"
              placeholder="Search..."
              class="w-full bg-gray-700 text-gray-100 rounded-full py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
        </div>

        <!-- Categories -->
        <nav class="space-y-2 mb-6">
          <a
            href="#"
            class="flex items-center space-x-3 p-2 rounded-lg bg-blue-700 text-white font-medium"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 6h12a1 1 0 100-2H4a1 1 0 100 2zm4 8h8a1 1 0 100-2H8a1 1 0 100 2zm0-4h8a1 1 0 100-2H8a1 1 0 100 2z"
              />
            </svg>
            <span>All Screenshots</span>
          </a>
          <a
            href="#"
            class="flex items-center space-x-3 p-2 rounded-lg text-gray-300 hover:bg-gray-700 transition"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                clip-rule="evenodd"
              />
            </svg>
            <span>Today</span>
          </a>
          <a
            href="#"
            class="flex items-center space-x-3 p-2 rounded-lg text-gray-300 hover:bg-gray-700 transition"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                clip-rule="evenodd"
              />
            </svg>
            <span>Last 7 Days</span>
          </a>
          <a
            href="#"
            class="flex items-center space-x-3 p-2 rounded-lg text-gray-300 hover:bg-gray-700 transition"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 110-6 3 3 0 010 6z"
              />
            </svg>
            <span>Work</span>
          </a>
        </nav>

        <!-- Tags -->
        <div class="mt-auto">
          <h2 class="text-sm font-semibold text-gray-400 mb-2">Tags</h2>
          <div class="flex flex-wrap gap-2">
            <span
              class="bg-gray-700 text-gray-300 text-xs px-3 py-1 rounded-full"
              >#design</span
            >
            <span
              class="bg-gray-700 text-gray-300 text-xs px-3 py-1 rounded-full"
              >#code</span
            >
            <span
              class="bg-gray-700 text-gray-300 text-xs px-3 py-1 rounded-full"
              >#marketing</span
            >
            <span
              class="bg-gray-700 text-gray-300 text-xs px-3 py-1 rounded-full"
              >#receipt</span
            >
            <span
              class="bg-gray-700 text-gray-300 text-xs px-3 py-1 rounded-full"
              >#inspiration</span
            >
            <span
              class="bg-gray-700 text-gray-300 text-xs px-3 py-1 rounded-full"
              >#bug-report</span
            >
          </div>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="flex-1 p-6 flex flex-col">
        <header id="header" class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-semibold">All Screenshots (124)</h2>
          <div class="flex space-x-2">
            <button
              class="bg-gray-700 text-gray-300 text-sm px-4 py-2 rounded-full hover:bg-gray-600 transition"
            >
              Sort By: Date
            </button>
            <button
              class="bg-blue-600 text-white text-sm px-4 py-2 rounded-full"
            >
              View: Grid
            </button>
          </div>
        </header>

        <!-- Screenshots Grid -->
        <div id="screenshotGrid" class="flex-1 overflow-y-auto">
          <div
            class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"
            id="screenshotContainer"
          >
            <!-- Screenshot cards will be dynamically inserted here by JavaScript -->
          </div>
        </div>

        <!-- Screenshot Detail View (Hidden by default) -->
        <div
          id="screenshotDetail"
          class="hidden flex-1 overflow-y-auto flex flex-col p-4"
        >
          <div class="flex items-center justify-between mb-4">
            <button
              id="backButton"
              class="bg-gray-700 text-white p-2 rounded-full hover:bg-gray-600 transition"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                />
              </svg>
            </button>
            <h2 id="detailTitle" class="text-2xl font-semibold">
              Screenshot Details
            </h2>
            <button
              id="analyzeButton"
              class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-500 transition shadow-lg flex items-center space-x-2"
            >
              <span>Analyze with Gemini âœ¨</span>
            </button>
          </div>
          <div class="flex flex-col lg:flex-row flex-1">
            <div class="lg:w-1/2 flex-shrink-0 mb-4 lg:mb-0 lg:mr-4">
              <img
                id="detailImage"
                src=""
                alt="Selected Screenshot"
                class="w-full rounded-xl object-contain h-full max-h-96"
              />
            </div>
            <div class="lg:w-1/2 flex flex-col space-y-4">
              <div
                id="loadingIndicator"
                class="hidden flex justify-center items-center h-full"
              >
                <div
                  class="animate-spin rounded-full h-10 w-10 border-4 border-gray-500 border-t-blue-500"
                ></div>
              </div>
              <div
                id="geminiOutput"
                class="hidden bg-gray-700 p-4 rounded-xl flex-1"
              >
                <h3 class="text-xl font-bold mb-2">Description</h3>
                <p id="geminiDescription" class="text-gray-300 mb-4"></p>
                <h3 class="text-xl font-bold mb-2">Generated Tags</h3>
                <div id="geminiTags" class="flex flex-wrap gap-2"></div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      const screenshots = [
        {
          id: 1,
          title: "UI Design Screenshot",
          date: "Oct 26, 2023",
          tags: ["design", "UI"],
          url: "https://ui-patterns.com/uploads/image/file/1126/best_5235.jpg",
          base64:
            "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",
        },
        {
          id: 2,
          title: "Code Snippet",
          date: "Oct 25, 2023",
          tags: ["code", "JS"],
          url: "https://www.economist.com/cdn-cgi/image/width=834,quality=80,format=auto/sites/default/files/images/2015/09/blogs/economist-explains/code2.png",
          base64:
            "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",
        },
        {
          id: 3,
          title: "Lunch Receipt",
          date: "Oct 24, 2023",
          tags: ["receipt", "finance"],
          url: "https://www.billdu.com/wp-content/uploads/2024/07/Receipt-template-example-724x1024.jpg",
          base64:
            "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",
        },
        {
          id: 4,
          title: "Article from Website",
          date: "Oct 23, 2023",
          tags: ["article", "inspiration"],
          url: "https://www.techwalls.com/wp-content/uploads/2012/07/article-format.jpg",
          base64:
            "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",
        },
        {
          id: 5,
          title: "Meeting Schedule",
          date: "Oct 22, 2023",
          tags: ["work", "calendar"],
          url: "https://dottotech.com/wp-content/uploads/2018/02/Google-Calendar-Screenshot.jpg",
          base64:
            "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",
        },
      ];

      // UI element references
      const screenshotContainer = document.getElementById(
        "screenshotContainer"
      );
      const screenshotGrid = document.getElementById("screenshotGrid");
      const screenshotDetail = document.getElementById("screenshotDetail");
      const detailTitle = document.getElementById("detailTitle");
      const detailImage = document.getElementById("detailImage");
      const backButton = document.getElementById("backButton");
      const analyzeButton = document.getElementById("analyzeButton");
      const loadingIndicator = document.getElementById("loadingIndicator");
      const geminiOutput = document.getElementById("geminiOutput");
      const geminiDescription = document.getElementById("geminiDescription");
      const geminiTags = document.getElementById("geminiTags");

      let selectedScreenshot = null;

      // Function to render screenshot cards
      function renderScreenshots() {
        screenshotContainer.innerHTML = "";
        screenshots.forEach((screenshot) => {
          const card = document.createElement("div");
          card.className =
            "bg-gray-700 rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-shadow cursor-pointer";
          card.setAttribute("data-id", screenshot.id);

          const tagsHtml = screenshot.tags
            .map(
              (tag) =>
                `<span class="bg-gray-600 text-xs text-gray-300 px-2 py-0.5 rounded-full">#${tag}</span>`
            )
            .join("");

          card.innerHTML = `
                    <img src="${screenshot.url}" alt="${screenshot.title}" class="w-full h-32 object-cover">
                    <div class="p-3">
                        <p class="text-sm font-medium truncate">${screenshot.title}</p>
                        <p class="text-xs text-gray-400">${screenshot.date}</p>
                        <div class="mt-2 flex flex-wrap gap-1">
                            ${tagsHtml}
                        </div>
                    </div>
                `;
          card.addEventListener("click", () => showDetailView(screenshot));
          screenshotContainer.appendChild(card);
        });
      }

      // Function to show the detail view
      function showDetailView(screenshot) {
        selectedScreenshot = screenshot;
        screenshotGrid.classList.add("hidden");
        screenshotDetail.classList.remove("hidden");
        detailImage.src = screenshot.url;
        detailTitle.textContent = screenshot.title;
        // Clear previous Gemini output
        geminiOutput.classList.add("hidden");
        geminiDescription.textContent = "";
        geminiTags.innerHTML = "";
      }

      // Function to return to the grid view
      function showGridView() {
        screenshotGrid.classList.remove("hidden");
        screenshotDetail.classList.add("hidden");
      }

      // Event listeners
      backButton.addEventListener("click", showGridView);

      // --- Gemini API Integration ---
      analyzeButton.addEventListener("click", async () => {
        if (!selectedScreenshot) return;

        loadingIndicator.classList.remove("hidden");
        geminiOutput.classList.add("hidden");
        analyzeButton.disabled = true;

        const base64ImageData = selectedScreenshot.base64; // In a real app, you would get this from the screenshot file

        try {
          // Exponential backoff retry logic
          let response = null;
          let retries = 0;
          while (retries < 3) {
            // Try up to 3 times
            try {
              const prompt =
                "Analyze this screenshot. Provide a brief, one-sentence description and a list of 5 key tags. Respond with a JSON object. The JSON schema should be: { 'description': 'string', 'tags': ['string', 'string', '...'] }";
              const payload = {
                contents: [
                  {
                    role: "user",
                    parts: [
                      { text: prompt },
                      {
                        inlineData: {
                          mimeType: "image/jpeg",
                          data: base64ImageData,
                        },
                      },
                    ],
                  },
                ],
                generationConfig: {
                  responseMimeType: "application/json",
                  responseSchema: {
                    type: "OBJECT",
                    properties: {
                      description: { type: "STRING" },
                      tags: {
                        type: "ARRAY",
                        items: { type: "STRING" },
                      },
                    },
                    propertyOrdering: ["description", "tags"],
                  },
                },
              };
              const apiKey = "";
              const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
              response = await fetch(apiUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              });
              if (response.ok) break; // Success, break the loop
            } catch (error) {
              console.error("API call failed, retrying...", error);
            }
            retries++;
            await new Promise((res) =>
              setTimeout(res, Math.pow(2, retries) * 1000)
            ); // Exponential backoff
          }

          if (!response || !response.ok) {
            throw new Error("API call failed after multiple retries.");
          }

          const result = await response.json();
          const jsonString = result.candidates[0].content.parts[0].text;
          const parsedResult = JSON.parse(jsonString);

          geminiDescription.textContent = parsedResult.description;
          geminiTags.innerHTML = parsedResult.tags
            .map(
              (tag) =>
                `<span class="bg-blue-600 text-white text-xs px-3 py-1 rounded-full">#${tag}</span>`
            )
            .join("");

          geminiOutput.classList.remove("hidden");
        } catch (error) {
          console.error("Failed to generate description or tags:", error);
          // Display error message to user
          geminiDescription.textContent =
            "Sorry, something went wrong. Please try again.";
          geminiTags.innerHTML = "";
          geminiOutput.classList.remove("hidden");
        } finally {
          loadingIndicator.classList.add("hidden");
          analyzeButton.disabled = false;
        }
      });

      // Initial render
      renderScreenshots();
    </script>
  </body>
</html>
